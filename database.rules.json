{
  "rules": {
    ".read": "auth !== null",
    ".write": "auth !== null",
    "publicRooms": {
      "$roomId": {
        ".validate": "newData.hasChildren(['name'])",
        "name": {
          ".validate": "newData.isString() && newData.val().length > 0"
        }
      }
    },
    "privateRooms": {
      "$roomId": {
        ".read": "root.child('roomMembers').child($roomId).child('members').child(auth.uid).exists()",
        ".validate": "newData.hasChildren(['name'])",
        "name": {
          ".validate": "newData.isString() && newData.val().length > 0"
        }
      }
    },
    "roomMembers": {},
    "messages": {
      "$roomId": {
        ".read": "root.child('publicRooms').child($roomId).exists() || root.child('roomMembers').child($roomId).child('members').child(auth.uid).exists()",
        ".write": "root.child('publicRooms').child($roomId).exists() || root.child('roomMembers').child($roomId).child('members').child(auth.uid).exists()",
        ".indexOn": [
          "timestamp"
        ],
        "$message": {
          ".write": "!data.exists()",
          ".validate": "newData.hasChildren(['author', 'content', 'timestamp'])",
          "userId": {
            ".validate": "newData.isString() && newData.val().length > 0"
          },
          "content": {
            ".validate": "newData.isString() && newData.val().length > 0"
          },
          "timestamp": {
            ".validate": "newData.isNumber() && newData.val() > 0"
          }
        }
      }
    },
    "messageSeenBy": {
      "$roomId": {
        ".read": "root.child('privateRooms').child($roomId).exists() && root.child('roomMembers').child($roomId).child('members').child(auth.uid).exists()",
        ".write": "root.child('privateRooms').child($roomId).exists() && root.child('roomMembers').child($roomId).child('members').child(auth.uid).exists()",
        "$message": {
          ".validate": "newData.hasChildren(['$userId']) && newData.child('$userId').isNumber() && newData.child('$userId').val() > 0"
        }
      }
    }
  }
}